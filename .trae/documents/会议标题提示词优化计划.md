# ä¼šè®®æ ‡é¢˜æç¤ºè¯ä¼˜åŒ–è®¡åˆ’

## é—®é¢˜åˆ†æ

å½“å‰ä¼šè®®æ ‡é¢˜ç”Ÿæˆé€»è¾‘å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **è…¾è®¯ä¼šè®® API è¿”å›çš„æ‘˜è¦æ ¼å¼**ï¼š`begin_summary` å­—æ®µå¸¸ä»¥"è¿™æ˜¯ä¸€åœºå…³äº..."å¼€å¤´
2. **æ™ºèƒ½æ ‡é¢˜æå–é€»è¾‘**ï¼šä» summary ç¬¬ä¸€å¥æå–æ ‡é¢˜æ—¶ï¼Œä¼šæŠŠ"è¿™æ˜¯ä¸€åœºå…³äºxxxçš„è®¨è®ºä¼š"ä½œä¸ºæ ‡é¢˜
3. **ç”¨æˆ·ä½“éªŒä¸ä½³**ï¼šæ ‡é¢˜ä»¥"è¿™æ˜¯ä¸€åœº"å¼€å¤´ï¼Œä¸å¤Ÿç®€æ´ç›´è§‚

### ç¤ºä¾‹

```
åŸå§‹æ ‡é¢˜: xxxçš„å¿«é€Ÿä¼šè®®
æ‘˜è¦ç¬¬ä¸€å¥: è¿™æ˜¯ä¸€åœºå…³äºä¼ä¸šå¾®ä¿¡APIé›†æˆä¸æ™ºèƒ½åŠ©æ‰‹åŠŸèƒ½å¼€å‘çš„è®¨è®ºä¼š
å½“å‰ç»“æœ: è¿™æ˜¯ä¸€åœºå…³äºä¼ä¸šå¾®ä¿¡APIé›†æˆä¸æ™ºèƒ½åŠ©æ‰‹åŠŸèƒ½å¼€å‘çš„è®¨è®ºä¼š
æœŸæœ›ç»“æœ: ä¼ä¸šå¾®ä¿¡APIé›†æˆä¸æ™ºèƒ½åŠ©æ‰‹åŠŸèƒ½å¼€å‘
```

---

## ä¿®æ”¹è®¡åˆ’

### 1. ä¿®æ”¹ `server/routers/meetings.py` ä¸­çš„ `generate_smart_title` å‡½æ•°

**ä½ç½®**ï¼šç¬¬ 50-71 è¡Œ

**ä¿®æ”¹å†…å®¹**ï¼š
```python
def generate_smart_title(title: str, summary: str) -> str:
    """
    æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆé€»è¾‘
    - è‹¥ä¸ºç³»ç»Ÿé»˜è®¤æ ‡é¢˜ï¼ˆå¦‚"xxxçš„å¿«é€Ÿä¼šè®®"ï¼‰ï¼Œæå– summary ç¬¬ä¸€å¥ä½œä¸ºæ–°æ ‡é¢˜
    - å¦åˆ™ä¿ç•™åŸæ ‡é¢˜
    """
    default_patterns = ["çš„å¿«é€Ÿä¼šè®®", "çš„ä¼šè®®", "å¿«é€Ÿä¼šè®®"]
    
    # æ£€æµ‹é»˜è®¤æ ‡é¢˜ç‰¹å¾
    for pattern in default_patterns:
        if pattern in title and len(title) < 30:
            # æå– summary ç¬¬ä¸€å¥ä½œä¸ºæ ‡é¢˜
            if summary:
                # æå–ç¬¬ä¸€å¥ï¼ˆä»¥å¥å·ã€é—®å·ã€æ„Ÿå¹å·ç»“å°¾ï¼‰
                sentences = re.split(r'[ã€‚ï¼ï¼Ÿ\n]', summary)
                for sentence in sentences:
                    sentence = sentence.strip()
                    if sentence and len(sentence) >= 5:
                        # è¿‡æ»¤"è¿™æ˜¯ä¸€åœº"ç­‰æ— æ•ˆå‰ç¼€
                        sentence = _clean_title_prefix(sentence)
                        if sentence and len(sentence) >= 5:
                            return sentence[:50]
            return title
    
    return title

def _clean_title_prefix(title: str) -> str:
    """
    æ¸…ç†æ ‡é¢˜ä¸­çš„æ— æ•ˆå‰ç¼€
    """
    # éœ€è¦ç§»é™¤çš„å‰ç¼€æ¨¡å¼
    prefix_patterns = [
        "è¿™æ˜¯ä¸€åœºå…³äº",
        "è¿™æ˜¯ä¸€åœº",
        "æœ¬æ¬¡ä¼šè®®æ˜¯å…³äº",
        "æœ¬æ¬¡ä¼šè®®",
        "ä¼šè®®å†…å®¹ï¼š",
        "ã€AI æ™ºèƒ½æ€»è§ˆã€‘",
        "ã€ç« èŠ‚å†…å®¹è¯¦æƒ…ã€‘",
        "ã€å‘è¨€äººè§‚ç‚¹æ•´åˆã€‘",
    ]
    
    for prefix in prefix_patterns:
        if title.startswith(prefix):
            title = title[len(prefix):].strip()
            # ç§»é™¤åå¯èƒ½è¿˜æœ‰"çš„è®¨è®ºä¼š"ã€"çš„ä¼šè®®"ç­‰åç¼€
            suffix_patterns = ["çš„è®¨è®ºä¼š", "çš„ä¼šè®®", "è®¨è®ºä¼š", "ä¼šè®®"]
            for suffix in suffix_patterns:
                if title.endswith(suffix) and len(title) > len(suffix) + 5:
                    title = title[:-len(suffix)]
                    break
            break
    
    return title.strip()
```

### 2. ä¿®æ”¹ `backend/server_receive.py` ä¸­çš„æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆé€»è¾‘

**ä½ç½®**ï¼šç¬¬ 380-398 è¡Œ

**ä¿®æ”¹å†…å®¹**ï¼š
```python
# æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆ
original_title = crawl_result.get("title", "ä¼šè®®çºªè¦")
smart_title = original_title

# æ£€æµ‹é»˜è®¤æ ‡é¢˜ç‰¹å¾
import re
default_patterns = ["çš„å¿«é€Ÿä¼šè®®", "çš„ä¼šè®®", "å¿«é€Ÿä¼šè®®"]
is_default_title = any(p in original_title for p in default_patterns) and len(original_title) < 30

if is_default_title and combined_summary:
    # æå– summary ç¬¬ä¸€å¥ä½œä¸ºæ ‡é¢˜
    sentences = re.split(r'[ã€‚ï¼ï¼Ÿ\n]', combined_summary)
    for sentence in sentences:
        sentence = sentence.strip()
        # è·³è¿‡"ã€ä¼šè®®å¾…åŠã€‘"è¿™æ ·çš„æ ‡é¢˜è¡Œ
        if sentence and len(sentence) >= 5 and not sentence.startswith('ã€'):
            # è¿‡æ»¤"è¿™æ˜¯ä¸€åœº"ç­‰æ— æ•ˆå‰ç¼€
            sentence = _clean_title_prefix(sentence)
            if sentence and len(sentence) >= 5:
                smart_title = sentence[:50]
                logger.info(f"ğŸ§  æ™ºèƒ½æ ‡é¢˜: '{original_title}' -> '{smart_title}'")
                break

def _clean_title_prefix(title: str) -> str:
    """æ¸…ç†æ ‡é¢˜ä¸­çš„æ— æ•ˆå‰ç¼€"""
    prefix_patterns = [
        "è¿™æ˜¯ä¸€åœºå…³äº",
        "è¿™æ˜¯ä¸€åœº",
        "æœ¬æ¬¡ä¼šè®®æ˜¯å…³äº",
        "æœ¬æ¬¡ä¼šè®®",
        "ä¼šè®®å†…å®¹ï¼š",
    ]
    for prefix in prefix_patterns:
        if title.startswith(prefix):
            title = title[len(prefix):].strip()
            suffix_patterns = ["çš„è®¨è®ºä¼š", "çš„ä¼šè®®", "è®¨è®ºä¼š", "ä¼šè®®"]
            for suffix in suffix_patterns:
                if title.endswith(suffix) and len(title) > len(suffix) + 5:
                    title = title[:-len(suffix)]
                    break
            break
    return title.strip()
```

---

## æ–‡ä»¶ä¿®æ”¹æ¸…å•

| æ–‡ä»¶ | ä¿®æ”¹å†…å®¹ |
|------|----------|
| `server/routers/meetings.py` | æ–°å¢ `_clean_title_prefix` å‡½æ•°ï¼Œä¿®æ”¹ `generate_smart_title` è°ƒç”¨å®ƒ |
| `backend/server_receive.py` | æ–°å¢ `_clean_title_prefix` å‡½æ•°ï¼Œä¿®æ”¹æ™ºèƒ½æ ‡é¢˜ç”Ÿæˆé€»è¾‘ |

---

## æµ‹è¯•ç”¨ä¾‹

| è¾“å…¥ | æœŸæœ›è¾“å‡º |
|------|----------|
| "è¿™æ˜¯ä¸€åœºå…³äºä¼ä¸šå¾®ä¿¡APIé›†æˆçš„è®¨è®ºä¼š" | "ä¼ä¸šå¾®ä¿¡APIé›†æˆ" |
| "è¿™æ˜¯ä¸€åœºæŠ€æœ¯åˆ†äº«ä¼šè®®" | "æŠ€æœ¯åˆ†äº«" |
| "æœ¬æ¬¡ä¼šè®®æ˜¯å…³äºé¡¹ç›®è¿›åº¦æ±‡æŠ¥" | "é¡¹ç›®è¿›åº¦æ±‡æŠ¥" |
| "ã€AI æ™ºèƒ½æ€»è§ˆã€‘è®¨è®ºäº†xxxé—®é¢˜" | "è®¨è®ºäº†xxxé—®é¢˜" |
| "æ­£å¸¸çš„ä¼šè®®æ ‡é¢˜" | "æ­£å¸¸çš„ä¼šè®®æ ‡é¢˜" (ä¸å˜) |

---

## é£é™©è¯„ä¼°

- **ä½é£é™©**ï¼šä»…ä¿®æ”¹æ ‡é¢˜ç”Ÿæˆé€»è¾‘ï¼Œä¸å½±å“ç°æœ‰æ•°æ®
- **å‘åå…¼å®¹**ï¼šå·²æœ‰ä¼šè®®æ ‡é¢˜ä¸ä¼šè¢«ä¿®æ”¹
- **å¯å›æ»š**ï¼šä¿®æ”¹ä»…æ¶‰åŠä¸¤ä¸ªå‡½æ•°ï¼Œæ˜“äºå›æ»š
