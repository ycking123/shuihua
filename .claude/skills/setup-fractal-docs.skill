# 设置分形文档 + 强制同构

为新文件或模块创建标准化的文档头部声明和模块文档。

---

## 使用场景

当需要以下操作时使用此技能：
- 创建新的代码文件
- 创建新的模块目录
- 为现有文件补充文档头部
- 更新模块成员清单

## 文档模板

### Python 文件头部模板

```python
# ============================================================================
# 文件: filename.py
# 模块: module_name
# 职责: 简短描述该文件的核心功能
#
# 依赖声明:
#   - 外部: 列出外部库依赖 (如: requests, fastapi, sqlalchemy)
#   - 本模块: 列出内部模块依赖 (如: backend.ai_handler, server.database)
#   - 可选: 列出可选依赖及其标志位
#
# 主要接口:
#   - function_name(param): 描述函数功能
#   - ClassName: 描述类功能
#
# 环境变量 (可选):
#   - ENV_VAR: 描述环境变量用途
#
# ============================================================================
```

### TypeScript/TSX 文件头部模板

```typescript
// ============================================================================
// 文件: FileName.tsx
// 模块: components (或其他模块名)
// 职责: 简短描述该组件的核心功能
//
// 依赖声明:
//   - 外部: react, lucide-react, 其他外部库
//   - 本项目: 项目内部模块 (如: types, constants)
//
// 主要组件:
//   - ComponentName: 组件描述
//
// ============================================================================

import React from 'react';
// ... 其他导入
```

### 模块文档模板 (MODULE.md)

```markdown
# `/模块名` 模块文档

## 模块职责
简述该模块的核心职责和功能定位。

## 成员清单

### 文件列表
| 文件 | 主要函数/类/组件 | 职责 |
|-----|-----------------|------|
| `file1.py` | `FunctionName` | 文件功能描述 |
| `file2.tsx` | `ComponentName` | 组件功能描述 |

### 子模块 (如果有)
| 目录 | 职责 |
|-----|------|
| `subdir/` | 子模块功能描述 |

## 接口说明

### 主要文件接口
```python
# 或 TypeScript/接口定义
def function_name(param: type) -> return_type:
    """
    函数功能描述

    Args:
        param: 参数说明

    Returns:
        返回值说明
    """
```

### 依赖关系
```python
# 或 import 语句
from module import something
```

### 环境变量 (如果有)
- `ENV_VAR`: 描述

---

**最后更新**: YYYY-MM-DD
```

## 执行步骤

### 为新文件添加头部声明

1. **读取文件**: `Read <文件路径>`
2. **添加头部**: 根据文件类型选择对应模板，填充：
   - 文件名
   - 所属模块
   - 职责说明（1-2 句话）
   - 依赖声明（从 import 语句提取）
   - 主要接口（主要函数/类/组件）
3. **保存文件**: `Write <文件路径>`

### 更新模块文档

1. **读取模块文档**: `Read <模块路径>/MODULE.md`
2. **检查成员清单**:
   - 运行 `ls -la <模块路径>` 查看实际文件
   - 对比 MODULE.md 中的成员清单
3. **更新清单**:
   - 添加新文件到表格
   - 移除已删除的文件
   - 更新文件职责描述
4. **保存文档**: `Write <模块路径>/MODULE.md`

### 创建新模块

1. **创建模块目录**: `mkdir -p <新模块路径>`
2. **创建 MODULE.md**: 使用模块文档模板
3. **为新模块添加到 MAP.md**:
   - 更新根目录的 `MAP.md`
   - 在"模块结构"部分添加新模块说明
   - 在"快速定位表"中添加相关条目
4. **运行检查**: `python scripts/check_docs_sync.py`

## 验证步骤

完成文档添加后，运行强制同构检查：

```bash
python scripts/check_docs_sync.py
```

确保：
- ✅ 新文件出现在模块成员清单中
- ✅ 新文件包含完整的头部声明
- ✅ 依赖声明准确
- ✅ 检查通过无警告

## 快捷命令

### 批量更新模块文档

```bash
# 列出模块所有 .py 文件
ls -la backend/*.py

# 检查特定模块
python scripts/check_docs_sync.py | grep "模块名"
```

---

**相关文件**:
- 全局地图: `MAP.md`
- 检查脚本: `scripts/check_docs_sync.py`
- 实施指南: `docs/FRACTAL_DOCS_GUIDE.md`

**核心原则**:
1. 文档和代码是同一事物的两个相
2. 任何一相变化，另一相必须同步更新
3. 每次代码变更后运行检查脚本验证
